{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://github.com/s3-proxy/bucket-settings-schema.json",
  "title": "S3 Proxy Bucket Settings",
  "description": "Per-bucket cache configuration for S3 Proxy. Place this file at cache_dir/metadata/{bucket}/_settings.json to override global cache settings for a specific bucket.",
  "type": "object",
  "additionalProperties": false,
  "properties": {
    "$schema": {
      "type": "string",
      "description": "Optional JSON Schema reference for IDE validation support."
    },
    "get_ttl": {
      "type": "string",
      "description": "TTL for cached GET responses. Human-readable duration: e.g. \"0s\", \"30s\", \"5m\", \"1h\", \"7d\". Set to \"0s\" to cache on disk but revalidate with S3 on every request (conditional GET with If-Modified-Since / If-None-Match). When \"0s\", range data is excluded from RAM cache.",
      "pattern": "^[0-9]+(ms|millis|milliseconds|s|sec|seconds|m|min|minutes|h|hr|hours|d|days)$",
      "examples": ["0s", "30s", "5m", "1h", "7d"]
    },
    "head_ttl": {
      "type": "string",
      "description": "TTL for cached HEAD responses. Same duration format as get_ttl. Set to \"0s\" to revalidate HEAD responses with S3 on every request.",
      "pattern": "^[0-9]+(ms|millis|milliseconds|s|sec|seconds|m|min|minutes|h|hr|hours|d|days)$",
      "examples": ["0s", "30s", "5m", "1h"]
    },
    "put_ttl": {
      "type": "string",
      "description": "TTL for write-cached PUT responses. Controls how long PUT data is retained on disk for subsequent GET requests.",
      "pattern": "^[0-9]+(ms|millis|milliseconds|s|sec|seconds|m|min|minutes|h|hr|hours|d|days)$",
      "examples": ["30s", "5m", "1h", "7d"]
    },
    "read_cache_enabled": {
      "type": "boolean",
      "description": "Enable or disable read caching for GET responses. When false, GET responses are streamed directly from S3 without caching to disk or RAM. Write caching (PUT) is independent. Default: true (from global config)."
    },
    "write_cache_enabled": {
      "type": "boolean",
      "description": "Enable or disable write-through caching for PUT operations. When false, PUT requests are forwarded to S3 but not cached locally. Default: from global config."
    },
    "compression_enabled": {
      "type": "boolean",
      "description": "Enable or disable LZ4 compression for cached data. Disable for buckets containing already-compressed data (images, videos, archives). Default: from global config."
    },
    "ram_cache_eligible": {
      "type": "boolean",
      "description": "Whether range data from this bucket can be stored in RAM cache. Set to false to reserve RAM cache for higher-priority buckets. Automatically forced to false when get_ttl is \"0s\" or read_cache_enabled is false. Default: true."
    },
    "prefix_overrides": {
      "type": "array",
      "description": "Per-prefix settings overrides within this bucket. When a request path matches a prefix, the prefix settings take precedence over bucket-level settings. If multiple prefixes match, the longest (most specific) prefix wins.",
      "items": {
        "$ref": "#/definitions/prefix_override"
      }
    }
  },
  "definitions": {
    "prefix_override": {
      "type": "object",
      "description": "Settings override for a specific key prefix within the bucket.",
      "required": ["prefix"],
      "additionalProperties": false,
      "properties": {
        "prefix": {
          "type": "string",
          "description": "Key prefix to match (e.g. \"/temp/\", \"/static/assets/\"). Must start with \"/\" and should end with \"/\" for directory-like matching.",
          "pattern": "^/",
          "minLength": 1
        },
        "get_ttl": {
          "type": "string",
          "description": "GET response TTL override for this prefix.",
          "pattern": "^[0-9]+(ms|millis|milliseconds|s|sec|seconds|m|min|minutes|h|hr|hours|d|days)$"
        },
        "head_ttl": {
          "type": "string",
          "description": "HEAD response TTL override for this prefix.",
          "pattern": "^[0-9]+(ms|millis|milliseconds|s|sec|seconds|m|min|minutes|h|hr|hours|d|days)$"
        },
        "put_ttl": {
          "type": "string",
          "description": "PUT write-cache TTL override for this prefix.",
          "pattern": "^[0-9]+(ms|millis|milliseconds|s|sec|seconds|m|min|minutes|h|hr|hours|d|days)$"
        },
        "read_cache_enabled": {
          "type": "boolean",
          "description": "Enable or disable read caching for this prefix."
        },
        "write_cache_enabled": {
          "type": "boolean",
          "description": "Enable or disable write caching for this prefix."
        },
        "compression_enabled": {
          "type": "boolean",
          "description": "Enable or disable compression for this prefix."
        },
        "ram_cache_eligible": {
          "type": "boolean",
          "description": "RAM cache eligibility for this prefix."
        }
      }
    }
  }
}
